{"version":3,"file":"main.es.js","sources":["../src/components/simple-text-editor.tsx","../src/components/topic-content-editor.tsx","../src/components/topic-desc-editor.tsx","../src/simple-text-editor-plugin.tsx"],"sourcesContent":["import { Controller, KeyType, Model } from '@blink-mind/core';\nimport debug from 'debug';\nimport * as React from 'react';\nimport plainSerializer from 'slate-plain-serializer';\nimport { Editor } from 'slate-react';\nimport styled from 'styled-components';\nconst log = debug('node:text-editor');\n\ninterface ContentProps {\n  readOnly?: boolean;\n}\n\nconst Content = styled.div<ContentProps>`\n  padding: 6px;\n  background-color: ${props => (props.readOnly ? null : 'white')};\n  cursor: ${props => (props.readOnly ? 'pointer' : 'text')};\n  min-width: 50px;\n`;\n\ninterface Props {\n  controller: Controller;\n  model: Model;\n  readOnly: boolean;\n  topicKey: KeyType;\n  saveRef?: Function;\n}\n\ninterface State {\n  content: any;\n}\n\nexport class SimpleTextEditor extends React.PureComponent<Props, State> {\n  state = {\n    content: null\n  };\n\n  onMouseDown = e => {\n    e.stopPropagation();\n  };\n\n  onMouseMove = e => {\n    // log('onMouseMove');\n    // e.stopPropagation();\n  };\n  onChange({ value }) {\n    log('onChange', value);\n    this.setState({ content: value });\n  }\n\n  onKeyDown = e => {};\n\n  componentDidMount() {\n    const { readOnly } = this.props;\n    if (readOnly) return;\n    document.addEventListener('click', this._handleClick);\n  }\n\n  componentWillUnmount() {\n    const { readOnly } = this.props;\n    if (readOnly) return;\n    document.removeEventListener('click', this._handleClick);\n  }\n\n  _handleClick = event => {\n    const wasOutside = !this.root.contains(event.target);\n    wasOutside && this.onClickOutSide(event);\n  };\n\n  onClickOutSide(e) {}\n\n  getCustomizeProps() {\n    return null;\n  }\n\n  constructor(props) {\n    super(props);\n    this.initState();\n  }\n\n  getContent() {\n    const { block } = this.getCustomizeProps();\n    let content = block.data;\n    if (content == null) return null;\n    if (typeof content === 'string') {\n      content = plainSerializer.deserialize(content);\n    }\n    return content;\n  }\n\n  initState() {\n    const content = this.getContent();\n    this.state = {\n      content\n    };\n  }\n\n  root;\n\n  rootRef = saveRef => ref => {\n    saveRef(ref);\n    this.root = ref;\n  };\n\n  render() {\n    const { topicKey, saveRef } = this.props;\n    const {\n      readOnly,\n      getRefKeyFunc,\n      placeholder,\n      style\n    } = this.getCustomizeProps();\n    log(readOnly);\n    const key = getRefKeyFunc(topicKey);\n    const content = readOnly ? this.getContent() : this.state.content;\n    const { onMouseDown, onMouseMove, onKeyDown } = this;\n    const editorProps = {\n      value: content,\n      readOnly,\n      onChange: this.onChange.bind(this),\n      placeholder,\n      style\n    };\n\n    const contentProps = {\n      key,\n      readOnly,\n      ref: this.rootRef(saveRef(key)),\n      onMouseDown,\n      onMouseMove,\n      onKeyDown\n    };\n    return (\n      <Content {...contentProps}>\n        <Editor {...editorProps} autoFocus />\n      </Content>\n    );\n  }\n}\n","import { BlockType, FocusMode, OpType } from '@blink-mind/core';\nimport debug from 'debug';\nimport { SimpleTextEditor } from './simple-text-editor';\nconst log = debug('node:topic-content-editor');\n\nfunction contentEditorRefKey(key) {\n  return `content-editor-${key}`;\n}\n\nexport class TopicContentEditor extends SimpleTextEditor {\n  constructor(props) {\n    super(props);\n  }\n  getCustomizeProps() {\n    const { model, topicKey, readOnly } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.CONTENT).block;\n    const getRefKeyFunc = contentEditorRefKey;\n    const style = {\n      whiteSpace: 'pre'\n    };\n    return {\n      block,\n      readOnly,\n      getRefKeyFunc,\n      placeholder: 'new',\n      style\n    };\n  }\n\n  onKeyDown = e => {\n    if (e.nativeEvent.ctrlKey && e.nativeEvent.code === 'Enter') {\n      this.save();\n    }\n  };\n\n  onClickOutSide(e) {\n    log('onClickOutSide');\n    this.save();\n  }\n\n  save() {\n    const { model, topicKey } = this.props;\n    const readOnly = model.editingContentKey !== topicKey;\n    if (readOnly) return;\n    const { controller } = this.props;\n    controller.run('operation', {\n      ...this.props,\n      opType: OpType.SET_TOPIC_BLOCK,\n      blockType: BlockType.CONTENT,\n      data: this.state.content,\n      focusMode: FocusMode.NORMAL\n    });\n  }\n}\n","import { BlockType } from '@blink-mind/core';\nimport { SimpleTextEditor } from './simple-text-editor';\n\nimport debug from 'debug';\nconst log = debug('node:topic-desc-editor');\n\nfunction descEditorRefKey(key) {\n  return `desc-editor-${key}`;\n}\n\nexport class TopicDescEditor extends SimpleTextEditor {\n  constructor(props) {\n    super(props);\n    log('constructor');\n  }\n\n  initState() {\n    super.initState();\n    const { controller, topicKey } = this.props;\n    const key = `topic-desc-data-${topicKey}`;\n    const value = this.state.content;\n    controller.run('setTempValue', { key, value });\n  }\n\n  getCustomizeProps() {\n    const { model, topicKey } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    const readOnly = model.editingDescKey !== topicKey;\n    const getRefKeyFunc = descEditorRefKey;\n    return {\n      block,\n      readOnly,\n      getRefKeyFunc,\n      placeholder: 'write topic notes here'\n    };\n  }\n\n  onChange({ value }) {\n    log('onChange');\n    const { controller, topicKey, model } = this.props;\n    const readOnly = model.editingDescKey !== topicKey;\n    if (readOnly) return;\n    const key = `topic-desc-data-${topicKey}`;\n    controller.run('setTempValue', { key, value });\n    this.setState({\n      content: value\n    });\n  }\n}\n","import { BlockType } from '@blink-mind/core';\nimport * as React from 'react';\nimport plainSerializer from 'slate-plain-serializer';\nimport { TopicContentEditor } from './components/topic-content-editor';\nimport { TopicDescEditor } from './components/topic-desc-editor';\n\nexport default function SimpleTextEditorPlugin() {\n  return {\n    getTopicTitle(props) {\n      const { model, controller, topicKey, maxLength } = props;\n      const topic = model.getTopic(topicKey);\n      const block = topic.getBlock(BlockType.CONTENT).block;\n      let text = controller.run('serializeBlockData', { ...props, block });\n      if (maxLength != null) {\n        text =\n          text.length > maxLength ? text.substr(0, maxLength) + '...' : text;\n      }\n      return text;\n    },\n\n    renderTopicContentEditor(props) {\n      return <TopicContentEditor {...props} />;\n    },\n\n    renderTopicDescEditor(props) {\n      return <TopicDescEditor {...props} />;\n    },\n\n    isBlockEmpty(props, next) {\n      const { block, controller } = props;\n      if (block.type === BlockType.CONTENT || block.type === BlockType.DESC) {\n        return (\n          block.data == null ||\n          controller.run('serializeBlockData', props) === ''\n        );\n      }\n      return next();\n    },\n\n    serializeBlockData(props, next) {\n      const { block } = props;\n      if (block.type === BlockType.CONTENT || block.type === BlockType.DESC) {\n        return typeof block.data === 'string'\n          ? block.data\n          : plainSerializer.serialize(block.data);\n      }\n      return next();\n    }\n  };\n}\n"],"names":["React.createElement","React.PureComponent","log"],"mappings":"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"}