{"version":3,"file":"main.js","sources":["../src/types/index.ts","../src/models/block.ts","../src/configs/theme/types.ts","../src/configs/theme/default-theme.ts","../src/models/config.ts","../src/utils/index.ts","../src/models/topic.ts","../src/models/utils/index.ts","../src/models/modifiers.ts","../src/models/model.ts","../src/plugins/core.ts","../src/controller.ts"],"sourcesContent":["import { Model } from '../models';\n\nexport type KeyType = string;\n\nexport type KeyPath = KeyType[];\n\nexport const TopicDirection = {\n  LEFT: 'L', // 从右向左\n  RIGHT: 'R', // 从左向右\n  BOTTOM: 'B', // 从上往下\n  MAIN: 'M' // root\n};\n\nexport enum DiagramLayoutType {\n  LEFT_TO_RIGHT,\n  RIGHT_TO_LEFT,\n  LEFT_AND_RIGHT,\n  TOP_TO_BOTTOM\n}\n\nexport const TopicVisualLevel = {\n  ROOT: 0,\n  PRIMARY: 1,\n  NORMAL: 2\n};\n\nexport const BlockType = {\n  CONTENT: 'CONTENT',\n  DESC: 'DESC'\n};\n\nexport const FocusMode = {\n  NORMAL: 'NORMAL',\n  EDITING_CONTENT: 'EDITING_CONTENT',\n  EDITING_DESC: 'EDITING_DESC',\n  SHOW_POPUP: 'SHOW_POPUP',\n  DRAGGING: 'DRAGGING'\n};\n\nexport type ModelChangeCallback = () => void;\n\nexport type OnChangeFunction = (\n  model: Model,\n  callback?: ModelChangeCallback\n) => void;\n\nexport const TopicRelationship = {\n  ANCESTOR: 'ANCESTOR',\n  DESCENDANT: 'DESCENDANT',\n  SIBLING: 'SIBLING',\n  NONE: 'NONE'\n};\n\nexport const OpType = {\n  TOGGLE_COLLAPSE: 'TOGGLE_COLLAPSE',\n  COLLAPSE_ALL: 'COLLAPSE_ALL',\n  EXPAND_ALL: 'EXPAND_ALL',\n  EXPAND_TO: 'EXPAND_TO',\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  FOCUS_TOPIC: 'FOCUS_TOPIC',\n  SET_FOCUS_MODE: 'SET_FOCUS_MODE',\n  SET_STYLE: 'SET_STYLE',\n  CLEAR_ALL_CUSTOM_STYLE: 'CLEAR_ALL_CUSTOM_STYLE',\n  SET_THEME: 'SET_THEME',\n  SET_TOPIC_BLOCK: 'SET_TOPIC_BLOCK',\n  DELETE_TOPIC_BLOCK: 'DELETE_TOPIC_BLOCK',\n  // SET_TOPIC_CONTENT: 'SET_TOPIC_CONTENT',\n  // SET_TOPIC_DESC: 'SET_TOPIC_DESC',\n  START_EDITING_CONTENT: 'START_EDITING_CONTENT',\n  START_EDITING_DESC: 'START_EDITING_DESC',\n  DRAG_AND_DROP: 'DRAG_AND_DROP',\n  SET_EDITOR_ROOT: 'SET_EDITOR_ROOT',\n  SET_LAYOUT_DIR: 'SET_LAYOUT_DIR'\n};\n","import { List, Record } from 'immutable';\nimport { KeyType } from '../types';\n\ntype BlockRecordType = {\n  type: string;\n  key?: KeyType;\n  data: any;\n};\n\nconst defaultBlockRecord: BlockRecordType = {\n  type: null,\n  key: null,\n  data: null\n};\n\nexport class Block extends Record(defaultBlockRecord) {\n  get data() {\n    return this.get('data');\n  }\n\n  get type() {\n    return this.get('type');\n  }\n\n  static create(obj: BlockRecordType): Block {\n    return new Block(obj);\n  }\n\n  static createList(obj: any): List<Block> {\n    if (List.isList(obj) || Array.isArray(obj)) {\n      // @ts-ignore\n      return List(obj.map(Block.create));\n    }\n    throw new Error(\n      `Block.createList only accepts Array or List, but you passed it: ${obj}`\n    );\n  }\n}\n","export type LinkStyle = {\n  lineType?: string;\n  lineWidth?: string;\n  lineColor?: string;\n  lineRadius?: number;\n};\n\nexport type TopicContentStyle = {\n  [key: string]: any;\n  background?: string;\n  color?: string;\n  fontSize?: string;\n  lineHeight?: string;\n  border?: string;\n  borderRadius?: string;\n  borderWidth?: string;\n  borderStyle?: string;\n  borderColor?: string;\n  padding?: string;\n};\n\nexport type TopicStyle = {\n  contentStyle?: TopicContentStyle;\n  linkStyle?: LinkStyle;\n  subLinkStyle?: LinkStyle;\n};\n\nexport type ThemeType = {\n  name: string;\n  background: string;\n  highlightColor: string;\n  randomColor?: boolean;\n  marginH: number;\n  marginV: number;\n\n  contentStyle?: TopicContentStyle;\n  linkStyle?: LinkStyle;\n\n  rootTopic?: TopicStyle;\n  primaryTopic?: TopicStyle;\n  normalTopic?: TopicStyle;\n};\n\nexport function isThemeType(obj: any): boolean {\n  return (\n    obj.name != null && obj.background != null && obj.highlightColor != null\n  );\n}\n\nexport interface Themes {\n  [fieldName: string]: ThemeType;\n}\n","import { ThemeType } from './types';\n\nexport const defaultTheme: ThemeType = {\n  name: 'default',\n  randomColor: true,\n  background: 'rgb(57,60,65)',\n  highlightColor: '#50C9CE',\n  marginH: 60,\n  marginV: 20,\n\n  contentStyle: {\n    lineHeight: '1.5'\n  },\n\n  linkStyle: {\n    lineRadius: 5,\n    lineType: 'curve',\n    lineWidth: '3px'\n  },\n\n  rootTopic: {\n    contentStyle: {\n      fontSize: '34px',\n      borderRadius: '35px',\n      padding: '16px 18px 16px 18px'\n    },\n    subLinkStyle: {\n      lineType: 'curve',\n      lineWidth: '3px',\n      lineColor: 'rgb(113, 203, 45)'\n    }\n  },\n  primaryTopic: {\n    contentStyle: {\n      borderWidth: '1px',\n      borderStyle: 'solid',\n      borderRadius: '20px',\n      fontSize: '17px',\n      padding: '10px 15px 10px 15px'\n    },\n\n    subLinkStyle: {\n      lineType: 'curve',\n      lineWidth: '3px',\n      lineColor: 'rgb(113, 203, 45)'\n    }\n  },\n\n  normalTopic: {\n    contentStyle: {\n      border: '1px solid #e8eaec',\n      borderRadius: '20px',\n      fontSize: '17px',\n      padding: '4px 10px'\n    },\n\n    subLinkStyle: {\n      lineType: 'curve',\n      lineWidth: '3px',\n      lineColor: 'white'\n    }\n  }\n};\n","import { Record } from 'immutable';\nimport { defaultTheme, ThemeType } from '../configs/theme';\nimport { DiagramLayoutType } from '../types';\n\ntype ConfigRecordType = {\n  readOnly?: boolean;\n  allowUndo?: boolean;\n  layoutDir?: DiagramLayoutType;\n  theme?: ThemeType;\n};\n\nconst defaultConfigRecord: ConfigRecordType = {\n  readOnly: false,\n  allowUndo: true,\n  layoutDir: DiagramLayoutType.LEFT_AND_RIGHT,\n  theme: defaultTheme\n};\n\nexport class Config extends Record(defaultConfigRecord) {\n  get layoutDir(): DiagramLayoutType {\n    return this.get('layoutDir');\n  }\n\n  get readOnly(): boolean {\n    return this.get('readOnly');\n  }\n\n  get allowUndo(): boolean {\n    return this.get('allowUndo');\n  }\n\n  get theme(): ThemeType {\n    return this.get('theme');\n  }\n\n  static fromJSON(obj) {\n    return new Config(obj);\n  }\n}\n","export function createKey() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = (Math.random() * 16) | 0,\n      v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n","import { List, Record } from 'immutable';\nimport { BlockType, KeyType } from '../types';\nimport { Block } from './block';\nimport { Relation } from './relation';\n\ntype TopicRecordType = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  subKeys?: List<KeyType>;\n  blocks?: List<Block>;\n  relations?: List<Relation>;\n  style?: string;\n};\n\ntype CreateTopicArg = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  content?: any;\n  subKeys?: List<KeyType> | KeyType[];\n  style?: string;\n};\n\nconst defaultTopicRecord: TopicRecordType = {\n  key: null,\n  parentKey: null,\n  collapse: false,\n  subKeys: null,\n  blocks: null,\n  relations: null,\n  style: null\n};\n\nexport class Topic extends Record(defaultTopicRecord) {\n  get key() {\n    return this.get('key');\n  }\n  get parentKey() {\n    return this.get('parentKey');\n  }\n  get collapse() {\n    return this.get('collapse');\n  }\n  get subKeys(): List<KeyType> {\n    return this.get('subKeys');\n  }\n  get blocks(): List<Block> {\n    return this.get('blocks');\n  }\n  get relations() {\n    return this.get('relations');\n  }\n  get style() {\n    return this.get('style');\n  }\n\n  getBlock(type: string): { index: number; block: Block } {\n    const index = this.blocks.findIndex(b => b.type === type);\n    if (index === -1) return { index, block: null };\n    return { index, block: this.blocks.get(index) };\n  }\n\n  static fromJSON(obj) {\n    const {\n      key,\n      parentKey = null,\n      blocks,\n      subKeys = [],\n      collapse = false\n    } = obj;\n    return new Topic({\n      key,\n      parentKey,\n      collapse,\n      subKeys: List(subKeys),\n      blocks: Block.createList(blocks)\n    });\n  }\n\n  static create({\n    key,\n    parentKey = null,\n    content = '',\n    subKeys = [],\n    collapse = false\n  }: CreateTopicArg): Topic {\n    const block = Block.create({\n      type: BlockType.CONTENT,\n      data: content,\n      key: null\n    });\n    const blocks = List([block]);\n    return new Topic({\n      key,\n      parentKey,\n      blocks,\n      subKeys: List(subKeys),\n      collapse\n    });\n  }\n}\n","import { KeyPath, KeyType, TopicRelationship } from '../../types';\nimport { Model } from '../model';\n\nexport function getAllSubTopicKeys(model: Model, topicKey: KeyType): KeyType[] {\n  const item = model.getTopic(topicKey);\n\n  let res = [];\n  if (item.subKeys.size > 0) {\n    const subKeys = item.subKeys.toArray();\n    res.push(...subKeys);\n    res = subKeys.reduce((acc, key) => {\n      acc.push(...getAllSubTopicKeys(model, key));\n      return acc;\n    }, res);\n  }\n  return res;\n}\n\nexport function getKeyPath(\n  model: Model,\n  topicKey: KeyType,\n  reverse: boolean = false\n): KeyPath {\n  const res = [topicKey];\n  let item = model.getTopic(topicKey);\n  while (item.parentKey) {\n    reverse ? res.push(item.parentKey) : res.unshift(item.parentKey);\n    item = model.getParentTopic(item.key);\n  }\n  return res;\n}\n\nexport function getRelationship(\n  model: Model,\n  srcKey: KeyType,\n  dstKey: KeyType\n): string {\n  const srcTopic = model.getTopic(srcKey);\n  const dstTopic = model.getTopic(dstKey);\n  if (srcTopic && dstTopic) {\n    if (srcTopic.parentKey == dstTopic.parentKey)\n      return TopicRelationship.SIBLING;\n    let pTopic = srcTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === dstTopic.key)\n        return TopicRelationship.DESCENDANT;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n    pTopic = dstTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === srcTopic.key) return TopicRelationship.ANCESTOR;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n  }\n  return TopicRelationship.NONE;\n}\n","import debug from 'debug';\nimport { ThemeType } from '../configs/theme/types';\nimport {\n  DiagramLayoutType,\n  FocusMode,\n  KeyType,\n  TopicRelationship\n} from '../types';\nimport { createKey } from '../utils';\nimport { Block } from './block';\nimport { Model } from './model';\nimport { Topic } from './topic';\nimport { getAllSubTopicKeys, getKeyPath, getRelationship } from './utils';\n\nconst log = debug('modifier');\n\nexport type ModifierArg =\n  | BaseModifierArg\n  | SetTopicArg\n  | SetBlockDataArg\n  | SetFocusModeArg\n  | SetTopicStyleArg\n  | SetZoomFactorArg\n  | SetThemeArg\n  | SetLayoutDirArg;\n\nexport type BaseModifierArg = {\n  model: Model;\n  topicKey?: KeyType;\n};\n\nexport type SetTopicArg = BaseModifierArg & {\n  topic: Topic;\n};\n\nexport type SetBlockDataArg = BaseModifierArg & {\n  blockType: string;\n  data: any;\n  focusMode?: string;\n};\n\nexport type DeleteBlockArg = BaseModifierArg & {\n  blockType: string;\n};\n\nexport type SetFocusModeArg = BaseModifierArg & {\n  focusMode: string;\n};\n\nexport type SetTopicStyleArg = BaseModifierArg & {\n  style: string;\n};\n\nexport type SetZoomFactorArg = BaseModifierArg & {\n  zoomFactor: number;\n};\n\nexport type SetThemeArg = BaseModifierArg & {\n  theme: ThemeType;\n};\n\nexport type SetLayoutDirArg = BaseModifierArg & {\n  layoutDir: DiagramLayoutType;\n};\n\nexport type ModifierResult = Model;\n\nfunction toggleCollapse({ model, topicKey }: BaseModifierArg): ModifierResult {\n  let topic = model.getTopic(topicKey);\n  if (topic && topic.subKeys.size !== 0) {\n    topic = topic.merge({\n      collapse: !topic.collapse\n    });\n    model = model.updateIn(\n      ['topics', topic.key, 'collapse'],\n      collapse => !collapse\n    );\n  }\n  model = focusTopic({ model, topicKey, focusMode: FocusMode.NORMAL });\n  return model;\n}\n\nfunction collapseAll({ model }: BaseModifierArg): ModifierResult {\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\n  log(model);\n  model = model.withMutations(m => {\n    topicKeys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], true);\n    });\n  });\n  model = focusTopic({\n    model,\n    topicKey: model.editorRootTopicKey,\n    focusMode: FocusMode.NORMAL\n  });\n  return model;\n}\n\nfunction expandAll({ model }: BaseModifierArg): ModifierResult {\n  const topicKeys = getAllSubTopicKeys(model, model.editorRootTopicKey);\n  log(model);\n  model = model.withMutations(m => {\n    topicKeys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], false);\n    });\n  });\n  log(model);\n  return model;\n}\n\nfunction expandTo({ model, topicKey }: BaseModifierArg): ModifierResult {\n  const keys = getKeyPath(model, topicKey).filter(t => t !== topicKey);\n  model = model.withMutations(m => {\n    keys.forEach(topicKey => {\n      m.setIn(['topics', topicKey, 'collapse'], false);\n    });\n  });\n  // 要让这个节点在视口中可见\n  if (\n    getRelationship(model, topicKey, model.editorRootTopicKey) !==\n    TopicRelationship.DESCENDANT\n  ) {\n    model = model.set('editorRootTopicKey', model.rootTopicKey);\n  }\n  return model;\n}\n\nfunction focusTopic({\n  model,\n  topicKey,\n  focusMode\n}: SetFocusModeArg): ModifierResult {\n  log('focus topic');\n  if (topicKey !== model.focusKey) model = model.set('focusKey', topicKey);\n  if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\n  return model;\n}\n\nfunction setFocusMode({ model, focusMode }: SetFocusModeArg): ModifierResult {\n  log('setFocusMode');\n  if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\n  return model;\n}\n\nfunction addChild({ model, topicKey }: BaseModifierArg): ModifierResult {\n  log('addChild:', topicKey);\n  let topic = model.getTopic(topicKey);\n  if (topic) {\n    const child = Topic.create({ key: createKey(), parentKey: topic.key });\n    topic = topic\n      .set('collapse', false)\n      .update('subKeys', subKeys => subKeys.push(child.key));\n    model = model.update('topics', topics =>\n      topics.set(topicKey, topic).set(child.key, child)\n    );\n    return focusTopic({\n      model,\n      topicKey: child.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction addSibling({ model, topicKey }: BaseModifierArg): ModifierResult {\n  if (topicKey === model.rootTopicKey) return model;\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const pItem = model.getTopic(topic.parentKey);\n    const idx = pItem.subKeys.indexOf(topicKey);\n    const sibling = Topic.create({ key: createKey(), parentKey: pItem.key });\n    model = model\n      .update('topics', topics => topics.set(sibling.key, sibling))\n      .updateIn(['topics', pItem.key, 'subKeys'], subKeys =>\n        subKeys.insert(idx + 1, sibling.key)\n      );\n    return focusTopic({\n      model,\n      topicKey: sibling.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction deleteTopic({ model, topicKey }: BaseModifierArg): ModifierResult {\n  if (topicKey === model.editorRootTopicKey) return model;\n  const item = model.getTopic(topicKey);\n  if (item) {\n    model = model.withMutations(m => {\n      m.update('topics', topics => {\n        topics = topics.delete(topicKey);\n        const deleteKeys = getAllSubTopicKeys(model, topicKey);\n        topics = topics.withMutations(t => {\n          deleteKeys.forEach(dKey => {\n            t.delete(dKey);\n          });\n        });\n        return topics;\n      });\n      m.updateIn(['topics', item.parentKey, 'subKeys'], subKeys =>\n        subKeys.delete(subKeys.indexOf(topicKey))\n      );\n      if (m.focusKey === topicKey)\n        m.set('focusKey', null).set('focusMode', null);\n    });\n  }\n\n  return model;\n}\n\n/**\n * setBlockData of one topic\n * @param model\n * @param topicKey\n * @param blockType\n * @param focusMode\n * @param data\n */\nfunction setBlockData({\n  model,\n  topicKey,\n  blockType,\n  focusMode,\n  data\n}: SetBlockDataArg): ModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index, block } = topic.getBlock(blockType);\n    if (index === -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\n        blocks.push(\n          Block.create({\n            type: blockType,\n            data: data\n          })\n        )\n      );\n    } else {\n      if (block.data !== data) {\n        model = model.updateIn(\n          ['topics', topicKey, 'blocks', index, 'data'],\n          dt => data\n        );\n      }\n    }\n    if (focusMode) {\n      model = focusTopic({\n        model,\n        topicKey,\n        focusMode\n      });\n    }\n  }\n  return model;\n}\n\nfunction deleteBlock({ model, topicKey, blockType }: DeleteBlockArg) {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index } = topic.getBlock(blockType);\n    if (index !== -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\n        blocks.delete(index)\n      );\n    }\n    model = focusTopic({\n      model,\n      topicKey: null,\n      focusMode: null\n    });\n  }\n  return model;\n}\n\nfunction setStyle({\n  model,\n  topicKey,\n  style\n}: SetTopicStyleArg): ModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    if (style !== topic.style) {\n      model = model.updateIn(['topics', topicKey, 'style'], s => style);\n    }\n  }\n  return model;\n}\n\nfunction clearAllCustomStyle({ model }: BaseModifierArg): ModifierResult {\n  model = model.withMutations(model => {\n    model.topics.keySeq().forEach(key => {\n      model.setIn(['topics', key, 'style'], null);\n    });\n  });\n  return model;\n}\n\nfunction setTheme({ model, theme }: SetThemeArg): ModifierResult {\n  model = model.setIn(['config', 'theme'], theme);\n  return model;\n}\n\nfunction setLayoutDir({ model, layoutDir }: SetLayoutDirArg): ModifierResult {\n  if (model.config.layoutDir === layoutDir) return model;\n  model = model.setIn(['config', 'layoutDir'], layoutDir);\n  return model;\n}\n\nfunction setEditorRootTopicKey({\n  model,\n  topicKey\n}: BaseModifierArg): ModifierResult {\n  if (model.editorRootTopicKey !== topicKey)\n    model = model.set('editorRootTopicKey', topicKey);\n  if (model.getTopic(topicKey).collapse)\n    model = model.setIn(['topics', topicKey, 'collapse'], false);\n  return model;\n}\n\nfunction setZoomFactor({\n  model,\n  zoomFactor\n}: SetZoomFactorArg): ModifierResult {\n  if (model.zoomFactor !== zoomFactor)\n    model = model.set('zoomFactor', zoomFactor);\n  return model;\n}\n\nexport default {\n  addChild,\n  addSibling,\n  toggleCollapse,\n  collapseAll,\n  expandAll,\n  expandTo,\n  focusTopic,\n  setFocusMode,\n  deleteTopic,\n  setBlockData,\n  deleteBlock,\n  setStyle,\n  clearAllCustomStyle,\n  setTheme,\n  setLayoutDir,\n  setEditorRootTopicKey,\n  setZoomFactor\n};\n","import { Map, Record } from 'immutable';\nimport isPlainObject from 'is-plain-object';\nimport { FocusMode, KeyType } from '../types';\nimport { createKey } from '../utils';\nimport { Config } from './config';\nimport { Topic } from './topic';\n\nexport type ExtData = Map<string, any>;\n\ntype ModelRecordType = {\n  topics: Map<KeyType, Topic>;\n  extData: ExtData; //用于插件做数据扩展\n  config: Config;\n  rootTopicKey: KeyType;\n  editorRootTopicKey?: KeyType;\n  focusKey?: KeyType;\n  focusMode?: string;\n  zoomFactor: number;\n  formatVersion?: string;\n};\n\nconst defaultModelRecord: ModelRecordType = {\n  topics: Map(),\n  extData: Map(),\n  config: new Config(),\n  rootTopicKey: null,\n  editorRootTopicKey: null,\n  focusKey: null,\n  focusMode: null,\n  formatVersion: null,\n  zoomFactor: 1\n};\n\nexport class Model extends Record(defaultModelRecord) {\n  static isModel(obj) {\n    return obj instanceof Model;\n  }\n  static create(attrs: any = null): Model {\n    if (attrs == null) return Model.createEmpty();\n    let res: Model;\n    if (Model.isModel(attrs)) {\n      res = attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      res = Model.fromJSON(attrs);\n    }\n    if (res) {\n      if (res.focusKey == null) {\n        res = res.set('focusKey', res.rootTopicKey);\n      }\n      if (res.focusMode == null) {\n        res = res.set('focusMode', FocusMode.NORMAL);\n      }\n      return res;\n    }\n\n    throw new Error(\n      `\\`Value.create\\` only accepts objects or values, but you passed it: ${attrs}`\n    );\n  }\n\n  static createEmpty(): Model {\n    const model = new Model();\n    const rootTopic = Topic.create({ key: createKey(), content: 'RootTopic' });\n    return model\n      .update('topics', topics => topics.set(rootTopic.key, rootTopic))\n      .set('rootTopicKey', rootTopic.key)\n      .set('editorRootTopicKey', rootTopic.key)\n      .set('focusKey', rootTopic.key)\n      .set('focusMode', FocusMode.NORMAL);\n  }\n\n  static fromJSON(object) {\n    let model = new Model();\n    const { topics = [], config = {}, rootTopicKey } = object;\n    let { editorRootTopicKey } = object;\n\n    if (editorRootTopicKey === undefined) editorRootTopicKey = rootTopicKey;\n\n    model = model.merge({\n      rootTopicKey,\n      editorRootTopicKey\n    });\n\n    model = model.withMutations(model => {\n      topics.forEach(topic => {\n        model.update('topics', topics =>\n          topics.set(topic.key, Topic.fromJSON(topic))\n        );\n      });\n      model.set('config', Config.fromJSON(config));\n    });\n\n    return model;\n  }\n\n  toJS() {\n    const obj = {\n      rootTopicKey: this.rootTopicKey,\n      topics: Object.values(this.topics.toJS()),\n      config: this.config,\n      extData: this.extData,\n      zoomFactor: this.zoomFactor\n    };\n    return obj;\n  }\n\n  get extData(): Map<string, any> {\n    return this.get('extData');\n  }\n\n  get topics(): Map<KeyType, Topic> {\n    return this.get('topics');\n  }\n\n  get config(): Config {\n    return this.get('config');\n  }\n\n  get formatVersion(): string {\n    return this.get('formatVersion');\n  }\n\n  get rootTopicKey(): KeyType {\n    return this.get('rootTopicKey');\n  }\n\n  get editorRootTopicKey(): KeyType {\n    return this.get('editorRootTopicKey');\n  }\n\n  get focusKey(): KeyType {\n    return this.get('focusKey');\n  }\n\n  get focusMode(): KeyType {\n    return this.get('focusMode');\n  }\n\n  get editingContentKey(): KeyType {\n    return this.focusMode === FocusMode.EDITING_CONTENT ? this.focusKey : null;\n  }\n\n  get editingDescKey(): KeyType {\n    return this.focusMode === FocusMode.EDITING_DESC ? this.focusKey : null;\n  }\n\n  getTopic(key: KeyType): Topic {\n    return this.topics.get(key);\n  }\n\n  getExtDataItem<T>(key: string, c: new () => T): T {\n    return this.extData.get(key) || new c();\n  }\n\n  getParentTopic(key: KeyType): Topic {\n    const topic = this.getTopic(key);\n    return topic.parentKey ? this.getTopic(topic.parentKey) : null;\n  }\n\n  getTopicVisualLevel(key: KeyType): number {\n    let topic = this.getTopic(key);\n    let level = 0;\n    while (topic && topic.key !== this.editorRootTopicKey) {\n      level++;\n      topic = this.getParentTopic(topic.key);\n    }\n    return level;\n  }\n\n  get rootTopic() {\n    return this.getTopic(this.rootTopicKey);\n  }\n\n  get zoomFactor() {\n    return this.get('zoomFactor');\n  }\n}\n","export function CorePlugin(options: any = {}) {\n  const { plugins = [] } = options;\n  return [...plugins];\n}\n","import debug from 'debug';\nimport memoizeOne from 'memoize-one';\nimport warning from 'tiny-warning';\nimport { Model } from './models';\nimport { CorePlugin } from './plugins/core';\nimport { ModelChangeCallback, OnChangeFunction } from './types';\n\nconst log = debug('core:controller');\n\nexport interface IControllerOption {\n  plugins?: Array<any>;\n  model?: Model;\n  readOnly?: boolean;\n  onChange?: OnChangeFunction;\n}\n\nexport interface IControllerRunContext {\n  controller: Controller;\n  model?: Model;\n  topicKey?: KeyType;\n  getRef?: Function;\n}\n\nexport interface IDiagram {\n  getDiagramProps(): IDiagramProps;\n  openNewModel(newModel: Model);\n}\n\nexport interface IDiagramProps {\n  model: Model;\n  controller: Controller;\n}\n\nfunction registerPlugin(controller: Controller, plugin: any) {\n  if (Array.isArray(plugin)) {\n    plugin.forEach(p => registerPlugin(controller, p));\n    return;\n  }\n\n  if (plugin == null) {\n    return;\n  }\n\n  for (const key in plugin) {\n    const fn = plugin[key];\n    controller.middleware[key] = controller.middleware[key] || [];\n    controller.middleware[key].push(fn);\n  }\n}\n\n// modified from koa-compose\nfunction compose(middleware) {\n  if (!Array.isArray(middleware))\n    throw new TypeError('Middleware stack must be an array!');\n  for (const fn of middleware) {\n    if (typeof fn !== 'function')\n      throw new TypeError('Middleware must be composed of functions!');\n  }\n\n  return function(context, next) {\n    // last called middleware #\n    let index = -1;\n    return dispatch(0);\n    function dispatch(i) {\n      if (i <= index) throw new Error('next() called multiple times');\n      index = i;\n      let fn = middleware[i];\n      if (i === middleware.length) fn = next;\n      if (!fn) return null;\n      try {\n        return fn(context, dispatch.bind(null, i + 1));\n      } catch (err) {\n        throw err;\n      }\n    }\n  };\n}\n\nexport class Controller {\n  middleware: Map<string, Function[]>;\n  private readonly onChange: OnChangeFunction;\n  public readOnly: boolean;\n  public currentModel: Model;\n\n  constructor(options: IControllerOption = {}) {\n    const { plugins = [], onChange, readOnly } = options;\n    this.readOnly = readOnly;\n    this.onChange = onChange;\n    this.middleware = new Map();\n    const corePlugin = CorePlugin({ plugins });\n    registerPlugin(this, corePlugin);\n  }\n\n  run(key: string, ...args: any[]) {\n    const { middleware } = this;\n    const fns = middleware[key] || [];\n    warning(fns.length !== 0, `the middleware function ${key} is not found!`);\n    const composedFn = memoizeOne(compose)(fns);\n    // @ts-ignore\n    return composedFn(...args);\n  }\n\n  getValue(propKey: string, arg?) {\n    return this.run('getValue', { ...arg, propKey });\n  }\n\n  change(model: Model, callback?: ModelChangeCallback) {\n    this.onChange(model, callback);\n    this.currentModel = model;\n  }\n}\n"],"names":["DiagramLayoutType","Record","List","Map","log"],"mappings":"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"}