{"version":3,"file":"main.js","sources":["../src/components/rich-text-editor.tsx","../src/components/topic-desc-editor.tsx","../src/markdown-serializer.ts","../src/rich-text-editor-plugin.tsx"],"sourcesContent":["import { Controller, KeyType, Model } from '@blink-mind/core';\nimport { BaseWidget } from '@blink-mind/renderer-react';\nimport RichMarkDownEditor from 'awehook-rich-markdown-editor';\nimport debug from 'debug';\nimport * as React from 'react';\nimport styled from 'styled-components';\nconst log = debug('node:topic-content-editor');\n\nconst NodeContent = styled.div`\n  ${props =>\n    !props.readOnly &&\n    `\n    // padding: 75px\n    // min-width: 150px\n    // min-height: 150px\n  `};\n`;\ninterface Props {\n  controller: Controller;\n  model: Model;\n  readOnly: boolean;\n  topicKey: KeyType;\n  saveRef?: Function;\n}\n\ninterface State {\n  content: any;\n}\n\nexport class RichTextEditor extends BaseWidget<Props, State> {\n  constructor(props) {\n    super(props);\n    this.initState();\n  }\n\n  initState() {\n    this.state = {\n      content: this.getContent()\n    };\n  }\n\n  getContent() {\n    const { block } = this.getCustomizeProps();\n    return block.data;\n  }\n\n  onMouseDown = e => {\n    e.stopPropagation();\n  };\n\n  onMouseMove = e => {\n    e.stopPropagation();\n  };\n  onChange(value) {\n    this.setState({\n      content: value\n    });\n  }\n\n  getCustomizeProps() {\n    return null;\n  }\n\n  componentDidMount() {\n    document.addEventListener('click', this._handleClick);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this._handleClick);\n  }\n\n  root;\n\n  rootRef = saveRef => ref => {\n    saveRef(ref);\n    this.root = ref;\n  };\n\n  _handleClick = event => {\n    const wasOutside = !this.root.contains(event.target);\n    wasOutside && this.onClickOutSide(event);\n  };\n\n  onClickOutSide(e) {}\n\n  render() {\n    const { topicKey, saveRef } = this.props;\n    const { readOnly, getRefKeyFunc, placeholder } = this.getCustomizeProps();\n    log('readOnly:', readOnly);\n    const content = readOnly ? this.getContent() : this.state.content;\n    if (content == null) return null;\n    const key = getRefKeyFunc(topicKey);\n    const { onMouseDown, onMouseMove } = this;\n    const richEditorProps = {\n      editorValue: content,\n      readOnly,\n      onChange: this.onChange.bind(this),\n      placeholder\n    };\n\n    const nodeContentProps = {\n      key,\n      ref: this.rootRef(saveRef(key)),\n      readOnly,\n      onMouseDown,\n      onMouseMove\n    };\n    return (\n      <NodeContent {...nodeContentProps}>\n        <RichMarkDownEditor {...richEditorProps} />\n      </NodeContent>\n    );\n  }\n}\n","import { BlockType } from '@blink-mind/core';\nimport { descEditorRefKey } from '@blink-mind/renderer-react';\nimport { RichTextEditor } from './rich-text-editor';\n\nexport class TopicDescEditor extends RichTextEditor {\n  initState() {\n    super.initState();\n    const { controller, topicKey } = this.props;\n    const key = `topic-desc-data-${topicKey}`;\n    const value = this.state.content;\n    controller.run('setTempValue', { key, value });\n  }\n\n  getCustomizeProps() {\n    const { model, topicKey } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    const readOnly = model.editingDescKey !== topicKey;\n    //TODO\n    const getRefKeyFunc = descEditorRefKey;\n    return {\n      block,\n      readOnly,\n      getRefKeyFunc,\n      placeholder: 'write topic notes here'\n    };\n  }\n\n  onChange(value) {\n    const { controller, topicKey } = this.props;\n    const key = `topic-desc-data-${topicKey}`;\n    controller.run('setTempValue', { key, value });\n    this.setState({\n      content: value\n    });\n  }\n}\n","import MarkdownSerializer from 'slate-md-serializer';\nexport default new MarkdownSerializer();\n","import { BlockType } from '@blink-mind/core';\nimport * as React from 'react';\nimport { TopicDescEditor } from './components/topic-desc-editor';\nimport markdownSerializer from './markdown-serializer';\nexport default function RichTextEditorPlugin() {\n  return {\n    renderTopicDescEditor(props) {\n      return <TopicDescEditor {...props} />;\n    },\n\n    isBlockEmpty(props, next) {\n      const { block, controller } = props;\n      if (block.type === BlockType.CONTENT || block.type === BlockType.DESC) {\n        return (\n          block.data == null ||\n          controller.run('serializeBlockData', props) === ''\n        );\n      }\n      return next();\n    },\n\n    serializeBlockData(props, next) {\n      const { block } = props;\n      if (block.type === BlockType.DESC) {\n        return typeof block.data === 'string'\n          ? block.data\n          : markdownSerializer.serialize(block.data);\n      }\n      return next();\n    }\n  };\n}\n"],"names":["React.createElement","BaseWidget","BlockType","descEditorRefKey"],"mappings":"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"}